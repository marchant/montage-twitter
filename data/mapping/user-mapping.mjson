{
    "root": {
        "prototype": "montage/data/service/expression-data-mapping",
        "properties": {
            "objectDescriptor": {"@": "UserDescriptorReference"},
            "rawDataPrimaryKeys":["name"],
            "objectMapping": {
                "rules": {
                    "avatar": {"<->": "photos.get(0)"},
                    "handle": {"<->": "username"},
                    "id": {"<->": "id"},
                    "name": {"<->": "displayName"},
                    "role": {
                        "<-": "{accessLevel: _accessLevel}",
                        "converter": {"@": "roleForeignKeyConverter"}
                    },
                    "timelineTweets": {
                        "<-": "{object: 'statuses', action: 'home_timeline'}",
                        "converter": {"@": "timelineTweetsForeignKeyConverter"}
                    },
                    "tweets": {
                        "<-": "{object: 'statuses', action: 'user_timeline', username: username}",
                        "converter": {"@": "tweetsForeignKeyConverter"}
                    }
                }
            },
            "rawDataMapping": {
                "rules": {
                }
            },
            "requisitePropertyNames": [
                "avatar", "handle", "id", "name", "role"
            ]
        }
    },
    
    "UserDescriptorReference": {
        "prototype": "montage/core/meta/object-descriptor-reference",
        "properties": {
            "valueReference": {
                "objectDescriptor": "User",
                "prototypeName": "User",
                "objectDescriptorModule": {"%": "data/model/user.mjson"}
            }
        }
    },

    "roleForeignKeyConverter": {
        "prototype": "montage/data/converter/raw-property-value-to-object-converter",
        "properties": {
            "convertExpression": "accessLevel == $.accessLevel"
        }
    },

    "timelineTweetsForeignKeyConverter": {
        "prototype": "montage/data/converter/raw-property-value-to-object-converter",
        "properties": {
            "convertExpression": "object == $.object && action == $.action"
        }
    },

    "tweetsForeignKeyConverter": {
        "prototype": "montage/data/converter/raw-property-value-to-object-converter",
        "properties": {
            "convertExpression": "object == $.object && action == $.action && username == $.username"
        }
    }
}
